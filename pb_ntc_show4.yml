---
- name: default setting
  hosts: r1
  connection: local
  gather_facts: no
  tasks:
  - name: show version
    ntc_show_command:
      platform: cisco_ios
      command: 'show version'
      host: "{{ inventory_hostname }}"
      template_dir: /root/.ansible/plugins/modules/ntc-ansible/ntc-templates/templates
      # template_dir: "{{ ntc_module_location }}/ntc-templates/templates"
      username: "{{ provider.username }}"
      password: "{{ provider.password }}"
    register: result

  # - name: show result
  #   debug: var=result.response

  - name: Get Hostname/Versions/Config-register
    set_fact:
        hostname: "{{ item.hostname }}"
        version: "{{ item.running_image }}"
        rommon: "{{ item.rommon }}"
        config_register: "{{ item.config_register }}"
    with_items: "{{ result.response }}"
    
  - name: Verify Hostname
    ignore_errors: yes
    assert:
          that:
              - '"{{ hostname }}" in "{{ inventory_hostname }}"'
          msg: "Failed - {{ inventory_hostname }} - hostname"
    
  # - name: show ip route result
  #   debug: 
  #     var: routeb.stdout_lines
  # - name: save the routing result
  #   template:
  #     src: "./routetable.j2"
  #     dest: "./results/{{inventory_hostname}}_routing.txt" 